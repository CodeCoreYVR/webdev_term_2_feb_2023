<div class="container mt-5">
  <h1 class="text-center">Product Show</h1>
  <div class="card border-light mx-auto">
    <div class="card-header bg-secondary text-white">
      <h3 class="card-title"><%= @product.title %></h3>
    </div>
    <div class="card-body">
      <div>
        <h3>Created By:</h3>
        <p class="card-text"><%= @product.user.full_name %></p>
      </div>
      <hr>
      <div>
        <h3>Description:</h3>
        <p class="card-text"><%= @product.description %></p>
      </div>
      <hr>
      <div>
        <h3>Price:</h3>
        <p class="card-text"><%= number_to_currency(@product.price) %></p>
      </div>
    </div>
      <div class="card-footer d-flex justify-content-around">
        <% if can? :update, @product %>
          <div>
            <%= link_to 'Edit', edit_product_path(@product), class: 'btn btn-secondary' %>
          </div>
        <% end %>
        <% if can? :delete, @product %>
          <div>
            <%= button_to 'Delete', product_path(@product), method: :delete, class: 'btn btn-secondary', onclick: "return confirm('Are you sure you want to delete this product?');" %>
          </div>
        <% end %>
      </div>
    <div class="card-header bg-secondary text-white">
      <h3 class="card-title">Create Review</h3>
    </div>
    <div class="card-body">
      <% if flash[:alert] %>
        <div class="alert alert-danger">
          <%= flash[:alert] %>
        </div>
      <% end %>
      <%= form_for [@product, @review], url: product_reviews_path(@product), method: :post do |f| %>
        <div class="form-group">
          <strong><%= f.label "rating:" %></strong>
          <%= f.number_field :rating, class: 'form-control' %>
        </div>
        <hr>
        <div class="form-group">
          <strong><%= f.label :body %></strong>
          <%= f.text_area :body, class: 'form-control' %>
        </div>
        <div class="card-footer text-center">
          <%= f.submit 'Submit', class: 'btn btn-secondary' %>
        </div>
      <% end %>
    </div>

    <div class="card-header bg-secondary text-white">
      <h3 class="card-title">Reviews:</h3>
    </div>
    <ul class="list-group">
      <% if @reviews && @reviews != [] %>
        <% @reviews.each do |review| %>
          <% if review.hidden? %>
            <% if can?(:unhide, review) %>
              <li class="list-group-item hidden-review">
                <div><%= review.rating %> <strong>~ <%= review.user.full_name %> ~</strong></div>
                <div><%= review.body %></div> 
                <div>
                  <% if can? :delete, review %>
                    <%= link_to "Delete", product_review_path(@product, review), method: :delete, data: { confirm: "Are you sure?" } %>
                  <% end %>
                  <%= link_to 'Unhide', unhide_product_review_path(@product, review), method: :put %>
                </div>
              </li>
            <% end %>
          <% else %>
            <li class="list-group-item">
              <div><%= review.rating %> <strong>~ <%= review.user.full_name %> ~</strong></div>
              <div><%= review.body %></div> 
              <div>
                <% if can? :delete, review %>
                  <%= link_to "Delete", product_review_path(@product, review), method: :delete, data: { confirm: "Are you sure?" } %>
                <% end %>
                <% if can?(:hide, review) %>
                  <%= link_to 'Hide', hide_product_review_path(@product, review), method: :put %>
                <% end %>
              </div>
            </li>
          <% end %>
        <% end %>
        <% if @reviews.all? { |review| review.hidden? } && current_user != @product.user %>
          <li class="list-group-item">No reviews ...yet</li>
        <% end %>
      <% else %>
        <li class="list-group-item">No reviews ...yet</li>
      <% end %>
    </ul>
  </div>
</div>